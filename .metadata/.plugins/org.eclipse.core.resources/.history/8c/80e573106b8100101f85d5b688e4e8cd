package com.courses.controller;

import java.sql.Connection;
import java.sql.DriverManager;

public class DBConnection {

    private static final String URL = "jdbc:mysql://localhost:3306/online_course";
    private static final String USER = "root";
    private static final String PASS = "admin#123";

    public static Connection getConnection() {
        Connection connection = null;
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            connection = DriverManager.getConnection(URL, USER, PASS);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return connection;
    }
}
3. Database Helper Classes
Studentdb.java
java
Copy code
package com.courses.controller;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.courses.model.Student;

public class Studentdb {

    public static List<Student> getAllStudents() {
        List<Student> list = new ArrayList<>();
        String selectQuery = "SELECT s.*, c.course_list FROM students s JOIN courses c ON s.id=c.student_id";
        try (Connection connection = DBConnection.getConnection();
             Statement stmt = connection.createStatement();
             ResultSet rs = stmt.executeQuery(selectQuery)) {
            
            while (rs.next()) {
                Student student = new Student();
                student.setId(rs.getInt("id"));
                student.setName(rs.getString("name"));
                student.setEmail(rs.getString("email"));
                student.setJoinDate(rs.getDate("join_date"));
                student.setFeesPaid(rs.getDouble("fees_paid"));
                student.setCourseList(rs.getString("course_list"));
                list.add(student);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return list;
    }

    public static Student getStudentByUsername(String username) {
        String selectQuery = "SELECT s.*, c.course_list FROM students s JOIN courses c ON s.id=c.student_id WHERE LOWER(s.name)=?";
        try (Connection connection = DBConnection.getConnection();
             PreparedStatement ps = connection.prepareStatement(selectQuery)) {

            ps.setString(1, username.toLowerCase());
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    Student student = new Student();
                    student.setId(rs.getInt("id"));
                    student.setName(rs.getString("name"));
                    student.setEmail(rs.getString("email"));
                    student.setJoinDate(rs.getDate("join_date"));
                    student.setFeesPaid(rs.getDouble("fees_paid"));
                    student.setCourseList(rs.getString("course_list"));
                    return student;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
}
Userdb.java
java
Copy code
package com.courses.controller;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import com.courses.model.User;

public class Userdb {

    public static User validateUser(String username, String password) {
        String selectQuery = "SELECT * FROM users WHERE username=? AND password=?";
        try (Connection connection = DBConnection.getConnection();
             PreparedStatement ps = connection.prepareStatement(selectQuery)) {

            ps.setString(1, username);
            ps.setString(2, password);
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    User user = new User();
                    user.setId(rs.getInt("id"));
                    user.setUsername(rs.getString("username"));
                    user.setRole(rs.getString("role"));
                    return user;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
}
4. Servlets
LoginServlet.java
java
Copy code
package com.courses.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.courses.model.User;

@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        User user = Userdb.validateUser(username, password);
        if (user != null) {
            HttpSession session = req.getSession();
            session.setAttribute("user", user);
            res.sendRedirect(req.getContextPath() + "/dashboard");
        } else {
            req.setAttribute("error", "Invalid credentials");
            req.getRequestDispatcher("/WEB-INF/jsp/error.jsp").forward(req, res);
        }
    }
}
DashboardServlet.java
java
Copy code
package com.courses.controller;

import java.io.IOException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.courses.model.Student;
import com.courses.model.User;

@WebServlet("/dashboard")
public class DashboardServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession(false);
        if (session == null) {
            resp.sendRedirect(req.getContextPath() + "/login.jsp");
            return;
        }

        User loggedInUser = (User) session.getAttribute("user");
        if (loggedInUser == null) {
            resp.sendRedirect(req.getContextPath() + "/login.jsp");
            return;
        }

        if ("admin".equalsIgnoreCase(loggedInUser.getRole())) {
            List<Student> students = Studentdb.getAllStudents();
            req.setAttribute("students", students);
            req.getRequestDispatcher("/WEB-INF/jsp/adminDashboard.jsp").forward(req, resp);
        } else if ("student".equalsIgnoreCase(loggedInUser.getRole())) {
            String username = loggedInUser.getUsername();
            Student student = Studentdb.getStudentByUsername(username);
            req.setAttribute("student", student);
            req.getRequestDispatcher("/WEB-INF/jsp/studentDashboard.jsp").forward(req, resp);
        } else {
            resp.sendRedirect(req.getContextPath() + "/login.jsp");
        }
    }
}
AdminServlet.java
java
Copy code
package com.courses.controller;

import java.io.IOException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.courses.model.Student;

@WebServlet("/admin")
public class AdminServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
        List<Student> all = Studentdb.getAllStudents();
        req.setAttribute("students", all);
        req.getRequestDispatcher("/WEB-INF/jsp/adminDashboard.jsp").forward(req, res);
    }
}
StudentServlet.java
java
Copy code
package com.courses.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.courses.model.Student;
import com.courses.model.User;

@WebServlet("/student")
public class StudentServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
        HttpSession session = req.getSession(false);
        if (session == null) {
            res.sendRedirect(req.getContextPath() + "/login.jsp");
            return;
        }

        User user = (User) session.getAttribute("user");
        if (user == null) {
            res.sendRedirect(req.getContextPath() + "/login.jsp");
            return;
        }

        Student s = Studentdb.getStudentByUsername(user.getUsername());
        req.setAttribute("student", s);
        req.getRequestDispatcher("/WEB-INF/jsp/studentDashboard.jsp").forward(req, res);
    }
}
5. JSP Pages (Put all under /WEB-INF/jsp/ except login.jsp)
adminDashboard.jsp
jsp
Copy code
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO


Ask ChatGPT


